<html>
	<head>
		<title>My first three.js app</title>
		<script type="module" src="three.js"></script>
		<script src="dat.gui.min.js"></script>
		<!--<script type="module" src="OrbitControls.js"></script>-->
		<!--<script type="module"src="AnaglyphEffect.js"></script>-->
		<script type="module" src="FresnelShader.js"></script>
		<script type="module" src="Quaternion.js"></script>
		<script type="module" src="Euler.js"></script>
		<script type="module" src="Vector3.js"></script>
		<script type="module" src="Matrix4.js"></script>
		<script type="module" src="MathUtils.js"></script>
		
		<!--<script src="https://threejs.org/three/build/three.js"></script>
		<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
		<script src="https://threejs.org/examples/js/effects/AnaglyphEffect.js"></script>
		<script src="https://threejs.org/examples/js/shaders/FresnelShader.js"></script>
		<script src="https://github.com/mrdoob/three.js/blob/dev/src/math/Quaternion.js"></script>
		<script src="https://threejs.org/three/src/math/Euler.js"></script>-->
		<style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
	</head>
	<body>


		<script type="module">

			//import * as THREE from '/three.module.js';

			//import { OrbitControls } from './OrbitControls.js';

			//import { AnaglyphEffect } from '/AnaglyphEffect.js';

			//import { FresnelShader } from '/FresnelShader.js';

			//import { Quaternion } from '/Quaternion.js';

			//import { Euler } from '/Euler.js';


			var qm = new THREE.Quaternion();
			var euler = new THREE.Euler();
			var quaternion1 = [0, 0, 0, 0];
			var _x;
			var _y;
			var _z;
			var rotationMatrix;
         	var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 100, window.innerWidth / window.innerHeight, 0.1, 1000 );
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			
			//TEXTURE
			var texture = THREE.ImageUtils.loadTexture( '/texture.jpg', {}, function(){ 
        // use to test when image gets loaded if it does
        
        }, 
        function(){ 
            alert('error') 
        });

			
				//	PO ZNACHENIAM GENERIT QUANTUNION AND EULER	
			function handleOrientation(event) {
			var absolute = event.absolute;
			var alpha    = event.alpha;
			var beta     = event.beta;
			var gamma    = event.gamma;
			quaternion1 = getQuaternion(alpha, beta, gamma);
			euler.set(_x, _y, _z); //radiani
			qm.set(quaternion1[1], quaternion1[2], quaternion1[3], quaternion1[0]);
			
			}

			var a = 0.5;
			var b = 1;

			var parametricDrop = function(u, v, vector) {

				let v0 = v * Math.PI * 2;
				let u0 = u * Math.PI;

			vector.x = a * (b - Math.cos(u0)) * Math.sin(u0) * Math.cos(v0);
			vector.y = a * (b - Math.cos(u0)) * Math.sin(u0) * Math.sin(v0);
			vector.z = Math.cos(u0);
			};
			
			var geometry = new THREE.ParametricGeometry( parametricDrop, 25, 25 );
			var material = new THREE.MeshBasicMaterial({map: texture});
			var mesh = new THREE.Mesh( geometry, material ) ;
			scene.add( mesh );
			


				
			//const controls = new OrbitControls( camera, renderer.domElement );
			camera.position.set( 0, 2, 1 );
			//controls.update();


	// LIGHT
	var light = new THREE.DirectionalLight( 0xffffff );
        light.position.set( 1, 1, 1 );
        scene.add( light );

        light = new THREE.DirectionalLight( 0x002288 );
        light.position.set( -1, -1, -1 );
        scene.add( light );

        light = new THREE.AmbientLight( 0x222222 );
        scene.add( light );


			//gui
			var eyeSep = 0.064;
			var FizzyText = function() {
			this.message = 'текст';
			this.eyeSep = 0.064;
			// Define render logic ...
			};   

			window.onload = function() {
			var text = new FizzyText();
			var gui  = new dat.GUI();
			var controllerEyeSep = gui.add(text, 'eyeSep', 0, 1);
			controllerEyeSep.onChange(function(value){
			eyeSep = value;
			effect.changeEyeSep(eyeSep);
			});
			};



			
			//var effect = new AnaglyphEffect( renderer );
			//effect.setSize(window.innerWidth, window.innerHeight);
			


			var animate = function () {
				requestAnimationFrame( animate );

				//controls.update();

				camera.applyQuaternion(qm);
				camera.quaternion.normalize();
				//camera.lookAt(euler.x, euler.y, euler.z);
				renderer.render( scene, camera );

			};

			animate();






window.addEventListener("deviceorientation", handleOrientation, true); 

//QUANTURNION
var degtorad = Math.PI / 180; // Degree-to-Radian conversion

function getQuaternion( alpha, beta, gamma ) {

    _x = beta  ? beta  * degtorad : 0; // beta value
    _y = gamma ? gamma * degtorad : 0; // gamma value
	_z = alpha ? alpha * degtorad : 0; // alpha value

  var cX = Math.cos( _x/2 );
  var cY = Math.cos( _y/2 );
  var cZ = Math.cos( _z/2 );
  var sX = Math.sin( _x/2 );
  var sY = Math.sin( _y/2 );
  var sZ = Math.sin( _z/2 );

  //
  // ZXY quaternion construction.
  //

  var w = cX * cY * cZ - sX * sY * sZ;
  var x = sX * cY * cZ - cX * sY * sZ;
  var y = cX * sY * cZ + sX * cY * sZ;
  var z = cX * cY * sZ + sX * sY * cZ;

  return [ w, x, y, z ];

}


		</script>
	</body>
</html>
